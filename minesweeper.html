
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minesweeper â€” Ethan Edition</title>
<style>
  :root{
    --bg:#0f1720;
    --panel:#0b1220;
    --accent:#ffd24a;
    --cell:#e6eef8;
    --flag:#ff6b6b;
    --text:#e6eef8;
  }
  *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #0b1b2b 100%);color:var(--text);display:flex;align-items:center;justify-content:center;padding:20px}
  .container{width:100%;max-width:880px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.03));padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.6);}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
  .title{font-weight:700;font-size:20px;display:flex;gap:10px;align-items:center}
  .controls{display:flex;gap:10px;align-items:center}
  select,input[type=number]{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text);padding:8px;border-radius:8px;min-width:60px}
  button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
  .info{display:flex;gap:8px;align-items:center}
  .badge{background:var(--panel);padding:8px 12px;border-radius:8px;display:flex;gap:8px;align-items:center;min-width:72px;justify-content:center;border:1px solid rgba(255,255,255,0.03)}
  .grid{display:grid;gap:4px;background:transparent;padding:12px;border-radius:8px;justify-content:center}
  .cell{width:36px;height:36px;background:var(--cell);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer;user-select:none;box-shadow:0 2px 0 rgba(0,0,0,0.15);font-size:16px;color:#05202b}
  .cell.revealed{background:linear-gradient(180deg,#f5f8fb, #e6eef8);cursor:default;box-shadow:none}
  .cell.mine{background:linear-gradient(180deg,#ffbfc0,#ff7b7b);color:white}
  .cell.flag{background:var(--flag);color:white}
  .controls-small{display:none}
  footer{margin-top:12px;font-size:13px;color:rgba(230,238,248,0.7);display:flex;justify-content:space-between;align-items:center}
  @media(max-width:560px){
    .cell{width:28px;height:28px;font-size:13px}
    .controls{display:none}
    .controls-small{display:flex;gap:8px;align-items:center}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="title">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M3 6h18M3 12h18M3 18h18" stroke="#ffd24a" stroke-width="1.6" stroke-linecap="round"/></svg>
      <div>
        <div style="font-size:14px">Minesweeper</div>
        <div style="font-size:12px;color:rgba(230,238,248,0.7)">Classic â€” made for you</div>
      </div>
    </div>
    <div class="controls">
      <label style="font-size:13px">Preset
        <select id="preset">
          <option value="easy">Easy (9Ã—9, 10 mines)</option>
          <option value="medium">Medium (16Ã—16, 40 mines)</option>
          <option value="hard">Hard (24Ã—16, 99 mines)</option>
          <option value="custom">Custom</option>
        </select>
      </label>
      <label style="font-size:13px">Cols <input id="cols" type="number" min="5" max="32" value="9"></label>
      <label style="font-size:13px">Rows <input id="rows" type="number" min="5" max="24" value="9"></label>
      <label style="font-size:13px">Mines <input id="mines" type="number" min="1" value="10"></label>
      <button id="resetBtn">New Game</button>
    </div>
    <div class="controls-small">
      <button id="flagToggle">Flag</button>
      <button id="resetBtn2">New</button>
    </div>
  </header>

  <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px">
    <div class="badge"><strong id="minesLeft">10</strong> mines</div>
    <div class="badge"><strong id="timer">0</strong> s</div>
    <div style="flex:1"></div>
    <div style="display:flex;gap:8px">
      <button id="easyQuick">Easy</button>
      <button id="mediumQuick">Med</button>
      <button id="hardQuick">Hard</button>
    </div>
  </div>

  <main>
    <div id="grid" class="grid" role="grid" aria-label="Minesweeper grid"></div>
  </main>

  <footer>
    <div>Left click to reveal Â· Right click to flag (or use Flag button on mobile)</div>
    <div>Made with ðŸ’›</div>
  </footer>
</div>

<script>
// --- Game logic ---
let cols = 9, rows = 9, minesCount = 10;
let gridEl = document.getElementById('grid');
let minesLeftEl = document.getElementById('minesLeft');
let timerEl = document.getElementById('timer');
let preset = document.getElementById('preset');
let colsInput = document.getElementById('cols');
let rowsInput = document.getElementById('rows');
let minesInput = document.getElementById('mines');
let resetBtn = document.getElementById('resetBtn');
let resetBtn2 = document.getElementById('resetBtn2');
let flagToggle = document.getElementById('flagToggle');
let easyQuick = document.getElementById('easyQuick');
let mediumQuick = document.getElementById('mediumQuick');
let hardQuick = document.getElementById('hardQuick');

let cells = [];
let started = false;
let timer = null;
let time = 0;
let flagMode = false;
let gameOver = false;

function setPreset(name){
  if(name==='easy'){ cols=9; rows=9; minesCount=10; }
  else if(name==='medium'){ cols=16; rows=16; minesCount=40; }
  else if(name==='hard'){ cols=24; rows=16; minesCount=99; }
  colsInput.value = cols; rowsInput.value = rows; minesInput.value = minesCount;
  updateGrid();
}

preset.addEventListener('change', ()=>{
  if(preset.value!=='custom') setPreset(preset.value);
});

easyQuick.onclick = ()=>{ preset.value='easy'; setPreset('easy'); startNewGame(); }
mediumQuick.onclick = ()=>{ preset.value='medium'; setPreset('medium'); startNewGame(); }
hardQuick.onclick = ()=>{ preset.value='hard'; setPreset('hard'); startNewGame(); }

colsInput.addEventListener('change', ()=>{ cols = clamp(parseInt(colsInput.value)||9,5,32); preset.value='custom'; updateGrid(); });
rowsInput.addEventListener('change', ()=>{ rows = clamp(parseInt(rowsInput.value)||9,5,24); preset.value='custom'; updateGrid(); });
minesInput.addEventListener('change', ()=>{ minesCount = clamp(parseInt(minesInput.value)||10,1,cols*rows-1); preset.value='custom'; updateGrid(); });

resetBtn.addEventListener('click', startNewGame);
resetBtn2.addEventListener('click', startNewGame);
flagToggle.addEventListener('click', ()=>{ flagMode = !flagMode; flagToggle.style.opacity = flagMode?0.8:1; });

cols = parseInt(colsInput.value); rows = parseInt(rowsInput.value); minesCount = parseInt(minesInput.value);

function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

function makeGrid(){
  cells = [];
  gridEl.innerHTML='';
  gridEl.style.gridTemplateColumns = `repeat(${cols}, auto)`;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell = document.createElement('div');
      cell.className='cell';
      cell.dataset.r = r; cell.dataset.c = c;
      cell.dataset.revealed = 0; cell.dataset.mine = 0; cell.dataset.flag = 0; cell.dataset.num = 0;
      cell.oncontextmenu = e=>{ e.preventDefault(); toggleFlag(cell); }
      cell.addEventListener('mousedown', (e)=>{ if(e.button===2) return; });
      cell.addEventListener('click', (e)=>{ if(gameOver) return; if(flagMode) return toggleFlag(cell); revealCell(cell); });
      // touch support: long press to flag
      let touchTimer = null;
      cell.addEventListener('touchstart', (ev)=>{ ev.preventDefault(); touchTimer = setTimeout(()=>{ toggleFlag(cell); touchTimer=null; }, 500); });
      cell.addEventListener('touchend', (ev)=>{ ev.preventDefault(); if(touchTimer){ clearTimeout(touchTimer); touchTimer=null; revealCell(cell); } });
      gridEl.appendChild(cell);
      cells.push(cell);
    }
  }
}

function startNewGame(){
  stopTimer();
  gameOver=false; started=false; time=0; timerEl.textContent='0';
  cols = clamp(parseInt(colsInput.value)||9,5,32);
  rows = clamp(parseInt(rowsInput.value)||9,5,24);
  minesCount = clamp(parseInt(minesInput.value)||10,1,cols*rows-1);
  minesLeftEl.textContent = minesCount;
  makeGrid();
}

function placeMines(excludeR, excludeC){
  // place mines randomly but avoid first clicked cell (excludeR, excludeC)
  let total = cols*rows;
  let positions = Array.from({length:total}, (_,i)=>i);
  // remove exclude index and neighbors for safer first click
  function rcToIndex(r,c){ return r*cols + c; }
  let avoid = new Set();
  for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
    let rr=excludeR+dr, cc=excludeC+dc;
    if(rr>=0 && rr<rows && cc>=0 && cc<cols) avoid.add(rcToIndex(rr,cc));
  }
  positions = positions.filter(i=>!avoid.has(i));
  // shuffle
  for(let i=positions.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [positions[i],positions[j]]=[positions[j],positions[i]]; }
  let picked = positions.slice(0,minesCount);
  picked.forEach(idx=>{
    let r = Math.floor(idx/cols), c = idx%cols;
    let cell = cells[idx];
    cell.dataset.mine = 1;
  });
  // set neighbor counts
  for(let r=0;r<rows;r++) for(let c=0;c<cols;c++){
    let idx = r*cols+c; let cell=cells[idx];
    if(cell.dataset.mine=='1') continue;
    let count=0;
    for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
      let rr=r+dr, cc=c+dc;
      if(rr>=0 && rr<rows && cc>=0 && cc<cols){
        if(cells[rr*cols+cc].dataset.mine=='1') count++;
      }
    }
    cell.dataset.num = count;
  }
}

function revealCell(cell){
  if(cell.dataset.revealed=='1' || cell.dataset.flag=='1') return;
  if(!started){
    // initialize mines avoiding this cell
    let r=parseInt(cell.dataset.r), c=parseInt(cell.dataset.c);
    placeMines(r,c);
    started=true; startTimer();
  }
  cell.dataset.revealed='1';
  cell.classList.add('revealed');
  let num = parseInt(cell.dataset.num||0);
  if(cell.dataset.mine=='1'){
    cell.classList.add('mine');
    cell.textContent = 'ðŸ’£';
    endGame(false);
    return;
  } else if(num>0){
    cell.textContent = num;
    applyNumberColor(cell,num);
  } else {
    // flood fill neighbors
    let r=parseInt(cell.dataset.r), c=parseInt(cell.dataset.c);
    for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){
      let rr=r+dr, cc=c+dc;
      if(rr>=0 && rr<rows && cc>=0 && cc<cols){
        let neighbor = cells[rr*cols+cc];
        if(neighbor.dataset.revealed=='0' && neighbor.dataset.flag=='0'){
          revealCell(neighbor);
        }
      }
    }
  }
  checkWin();
}

function applyNumberColor(cell,num){
  const colors = ['#05202b','#2266ff','#2e8b57','#dd6b20','#c02a2a','#3b2f73','#2f5f6f','#0b0b0b'];
  cell.style.color = colors[(num-1)%colors.length] || '#05202b';
}

function toggleFlag(cell){
  if(cell.dataset.revealed=='1') return;
  if(cell.dataset.flag=='1'){ cell.dataset.flag='0'; cell.classList.remove('flag'); cell.textContent=''; }
  else { cell.dataset.flag='1'; cell.classList.add('flag'); cell.textContent='ðŸš©'; }
  updateMinesLeft();
  checkWin();
}

function updateMinesLeft(){
  let flags = cells.filter(c=>c.dataset.flag=='1').length;
  minesLeftEl.textContent = Math.max(0, minesCount - flags);
}

function startTimer(){
  timer = setInterval(()=>{ time++; timerEl.textContent = time; }, 1000);
}

function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

function endGame(win){
  gameOver=true; stopTimer();
  // reveal all mines
  cells.forEach(c=>{
    if(c.dataset.mine=='1'){ c.classList.add('revealed'); c.textContent='ðŸ’£'; c.classList.add('mine'); }
  });
  setTimeout(()=>{
    if(win) alert('You win! ðŸŽ‰ Time: '+time+'s');
    else alert('Boom â€” you hit a mine. Try again!');
  }, 80);
}

function checkWin(){
  // win if all non-mine cells are revealed OR all mines are flagged (and no extra flags)
  let unrevealedNonMines = cells.filter(c=>c.dataset.revealed=='0' && c.dataset.mine=='0').length;
  if(unrevealedNonMines===0){ endGame(true); return; }
  // optional: if flags equal mines and flags on all mines
  let flags = cells.filter(c=>c.dataset.flag=='1').length;
  if(flags===minesCount){
    let allCorrect = cells.filter(c=>c.dataset.flag=='1').every(c=>c.dataset.mine=='1');
    if(allCorrect) endGame(true);
  }
}

document.addEventListener('keydown', (e)=>{ if(e.key==='f' || e.key==='F'){ flagMode=!flagMode; flagToggle.style.opacity = flagMode?0.8:1; } });

// disable context menu on grid for cleaner right-click usage
gridEl.addEventListener('contextmenu', (e)=>e.preventDefault());

// init
setPreset('easy');
startNewGame();
</script>
</body>
</html>
